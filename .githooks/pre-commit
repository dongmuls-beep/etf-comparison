#!/bin/sh
set -eu

# Keep local changelog.json aligned with production before each commit.
if [ -x "./.venv/Scripts/python.exe" ] && ./.venv/Scripts/python.exe -V >/dev/null 2>&1; then
  ./.venv/Scripts/python.exe scripts/sync_server_changelog.py --stage --allow-fail
elif command -v python3 >/dev/null 2>&1 && python3 -V >/dev/null 2>&1; then
  python3 scripts/sync_server_changelog.py --stage --allow-fail
elif command -v py >/dev/null 2>&1 && py -3 -V >/dev/null 2>&1; then
  py -3 scripts/sync_server_changelog.py --stage --allow-fail
elif command -v python >/dev/null 2>&1 && python -V >/dev/null 2>&1; then
  python scripts/sync_server_changelog.py --stage --allow-fail
else
  echo "[pre-commit] python is not available; skipping changelog sync" >&2
  exit 0
fi
